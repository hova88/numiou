import numpy as np 
import matplotlib.pylab as plt
import matplotlib.patches as patches

import numiou as niou
if __name__ == "__main__":
    zeros = np.zeros((20,1))
    box_template = np.array([
        [-4.56641, -27.0469, -1.80273, 0.421875, 0.465332, 1.22183,  1.45996],
        [-4.57812,  27.0938,  0.32251, 0.416748, 0.372070, 1.05184,  0.77002],
        [-0.43676,  18.8900, -0.26562, 0.386475, 0.377930, 1.25785, -1.43555],
        [ 5.03125,  15.4141, -0.52832, 0.388184, 0.375488, 1.07160, -1.50293],
        [-1.21582,  18.5156, -0.41040, 0.373291, 0.371338, 0.99881, -0.61425], 
        [-0.14209,  24.3438, -0.14904, 0.388428, 0.367920, 0.77050, -1.02148],
        [ 0.33056,  24.375 , -0.10821, 0.410156, 0.371826, 0.77069, -0.70996], 
        [ 41.6875,  16.7188, -1.56641, 0.392578, 0.406006, 1.06297,  0.65380], 
        [-13.4141,  30.1875,  0.02137, 0.367432, 0.368408, 0.71329,  0.68798], 
        [-1.38965,  24.0625, -0.18713, 0.356445, 0.387207, 0.84293,  0.80712], 
        [-10.7188,  9.79688, -0.54248, 0.368652, 0.374268, 1.27221,  0.30835],
        [-4.98828, -26.1875, -1.92871, 0.387695, 0.404541, 0.95586,  1.51855],
        [11.3906 ,  3.65625, -1.17285, 0.404297, 0.402344, 0.81262, -0.19824], 
        [9.28125 , -9.47656, -1.68848, 0.395020, 0.404297, 0.73809, -0.21447], 
        [11.1484 ,  3.42773, -1.23535, 0.396240, 0.401611, 0.76975, -0.27465], 
        [9.77344 , -9.17188, -1.64551, 0.363037, 0.379883, 0.75560, -0.20227], 
        [9.04688 , -9.82031, -1.67969, 0.400391, 0.418701, 0.76937, -0.11938], 
        [8.67969 , -10.1328, -1.71191, 0.392090, 0.395264, 0.71504, -0.19311], 
        [8.75781 , -9.61719, -1.65234, 0.369873, 0.383301, 0.74388, -0.27563], 
        [8.60156 , -10.6250, -1.72363, 0.375977, 0.394775, 0.75930, -0.15759], 
    ])

    boxes_a = box_template + np.hstack((
            np.random.rand(20,1),np.random.rand(20,1),zeros,
            np.random.rand(20,1),np.random.rand(20,1),zeros,
            np.random.rand(20,1) * np.pi*2))

    boxes_b = box_template + np.hstack((
            np.random.rand(20,1),np.random.rand(20,1),zeros,
            np.random.rand(20,1),np.random.rand(20,1),zeros,
            np.random.rand(20,1) * np.pi*2))
    iou = niou.bev(boxes_a,boxes_a[0:1,:])


    canvas_width = 200
    canvas_height = 200
    fig, ax = plt.subplots(figsize=(10,10))
    ax.set_xlim(0,canvas_width)
    ax.set_ylim(0,canvas_height)
    ax.add_patch(boxes_a)
    ax.add_patch(boxes_b)

    ax.grid()
    ax.legend(fontsize=15)
    ax.tick_params(axis='x', labelsize=15)
    ax.tick_params(axis='y', labelsize=15)
    
    print(iou.shape)
    print(iou)